#! /usr/bin/env bash

set -e
set -u

ANSIBLE_VERSION="${ANSIBLE_VERSION:-}"

if command -v ansible-playbook &>/dev/null; then
    exec ansible-playbook "$@"
else
    if [[ -n "$ANSIBLE_VERSION" ]]; then
        flock /tmp/ansible-playbook-install pip install "ansible-core==$ANSIBLE_VERSION" ansible 1>&2
    else
        flock /tmp/ansible-playbook-install pip install ansible 1>&2
    fi

    exec /usr/local/bin/ansible-playbook "$@"
fi
